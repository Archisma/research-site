<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Aurora Systems Research Facility</title>

  <style>
    :root{
      --bg:#0b1020;
      --panel:#111a33;
      --panel-soft:rgba(255,255,255,.06);
      --border:rgba(255,255,255,.14);
      --text:#e9eeff;
      --muted:#aab6d6;
      --accent:#6aa6ff;
      --accent-soft:rgba(106,166,255,.15);
      --radius:16px;
      --danger:#ff6a6a;
      --ok:#79ffa6;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 10% 10%, #17244a 0%, var(--bg) 55%),
        linear-gradient(180deg,#0e1530,var(--bg));
    }

    .container{max-width:1200px;margin:0 auto;padding:22px}

    .card{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:16px;
    }

    /* ---------- Lineage table ---------- */
    .tableWrap{
      margin-top:10px;
      overflow:auto;
      border:1px solid var(--border);
      border-radius:14px;
      background:rgba(0,0,0,.18);
    }
    table.prettyTable{
      width:100%;
      border-collapse:collapse;
      min-width:600px;
      font-size:13px;
    }
    table.prettyTable th, table.prettyTable td{
      border-bottom:1px solid rgba(255,255,255,.1);
      padding:10px 12px;
      vertical-align:top;
      text-align:left;
    }
    table.prettyTable th{
      background:#111a33;
      font-weight:800;
    }
    table.prettyTable td:first-child{
      width:260px;
      font-weight:800;
      white-space:nowrap;
    }

    textarea{
      width:100%;
      min-height:220px;
      background:rgba(0,0,0,.25);
      color:var(--text);
      border:1px solid var(--border);
      border-radius:14px;
      padding:12px;
      font-family:ui-monospace,monospace;
    }
  </style>
</head>

<body>
<div class="container">
  <div class="card">
    <h2>Lineage Intelligence</h2>

    <input id="lineageQuery" placeholder="e.g. Where does daily_active_users come from?" />

    <button onclick="runLineage()">Run lineage</button>

    <!-- TABLE OUTPUT -->
    <div class="tableWrap" id="lineageTableWrap" style="display:none">
      <table class="prettyTable" id="lineageTable"></table>
    </div>

    <!-- FALLBACK TEXT -->
    <textarea id="lineageOut" readonly style="display:none"></textarea>
  </div>
</div>

<script>
const API_BASE = "https://aurora-research-backend.onrender.com";
const LINEAGE_URL = API_BASE + "/lineage";

function escapeHtml(s){
  return String(s)
    .replace(/&/g,"&amp;")
    .replace(/</g,"&lt;")
    .replace(/>/g,"&gt;");
}

function parseMarkdownTable(md){
  const lines = md.split("\n").map(l=>l.trim()).filter(Boolean);
  const header = lines.find(l=>l.startsWith("|"));
  if(!header) return null;

  const headerIdx = lines.indexOf(header);
  const headers = header.split("|").map(s=>s.trim()).filter(Boolean);
  const rows = [];

  for(let i=headerIdx+2;i<lines.length;i++){
    if(!lines[i].startsWith("|")) continue;
    rows.push(lines[i].split("|").map(s=>s.trim()).filter(Boolean));
  }
  return {headers, rows};
}

function renderLineage(answer){
  const parsed = parseMarkdownTable(answer);
  const table = document.getElementById("lineageTable");
  const wrap = document.getElementById("lineageTableWrap");
  const ta = document.getElementById("lineageOut");

  if(parsed){
    let html = "<thead><tr>";
    parsed.headers.forEach(h=>html+=`<th>${escapeHtml(h)}</th>`);
    html += "</tr></thead><tbody>";

    parsed.rows.forEach(r=>{
      html += `<tr><td>${escapeHtml(r[0])}</td><td>${escapeHtml(r[1]).replace(/\\n/g,"<br>")}</td></tr>`;
    });
    html += "</tbody>";

    table.innerHTML = html;
    wrap.style.display = "block";
    ta.style.display = "none";
  } else {
    ta.value = answer;
    ta.style.display = "block";
    wrap.style.display = "none";
  }
}

async function runLineage(){
  const q = document.getElementById("lineageQuery").value.trim();
  if(!q) return;

  const r = await fetch(LINEAGE_URL,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({query:q})
  });
  const d = await r.json();
  renderLineage(d.answer || JSON.stringify(d,null,2));
}
</script>

<footer style="margin-top:20px;color:#aab6d6">
  Author: <strong>Archisma Ghosal</strong> â€¢ Contact: +13023633094
</footer>

</body>
</html>
