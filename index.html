<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Aurora Systems Research Facility</title>

  <style>
    :root{
      --bg:#0b1020;
      --panel:#111a33;
      --panel-soft:rgba(255,255,255,.06);
      --border:rgba(255,255,255,.14);
      --text:#e9eeff;
      --muted:#aab6d6;
      --accent:#6aa6ff;
      --accent-soft:rgba(106,166,255,.15);
      --radius:16px;
      --danger:#ff6a6a;
      --ok:#79ffa6;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 10% 10%, #17244a 0%, var(--bg) 55%),
        linear-gradient(180deg,#0e1530,var(--bg));
    }

    .container{max-width:1200px;margin:0 auto;padding:22px}

    .hero{
      text-align:center;
      background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));
      border:1px solid var(--border);
      border-radius:22px;
      padding:26px 18px;
      box-shadow:0 20px 60px rgba(0,0,0,.3);
    }
    .hero h1{margin:0;font-size:40px}
    .hero p{margin:10px 0 0;color:var(--muted)}
    .hero .sub{margin-top:8px;font-size:13px;color:var(--muted)}
    .hero .sub a{color:var(--accent);text-decoration:none}
    .hero .sub a:hover{text-decoration:underline}

    .grid{
      margin-top:18px;
      display:grid;
      grid-template-columns:1fr;
      gap:16px;
    }

    .card{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:16px;
      box-shadow:0 18px 40px rgba(0,0,0,.35);
    }

    /* Tabs */
    .tabs{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:center;
      margin-top:14px;
    }
    .tab{
      padding:10px 14px;
      border-radius:999px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.06);
      color:var(--muted);
      cursor:pointer;
      user-select:none;
      transition:.12s ease;
      font-weight:700;
      font-size:13px;
    }
    .tab:hover{border-color:var(--accent);background:var(--accent-soft);color:var(--text)}
    .tab.active{
      border-color:var(--accent);
      background:linear-gradient(180deg,#7bb1ff,#5a90ff);
      color:#08142f;
    }

    label{display:block;font-size:13px;color:var(--muted);margin:10px 0 6px}
    input,select,textarea{
      width:100%;
      background:rgba(0,0,0,.25);
      color:var(--text);
      border:1px solid var(--border);
      border-radius:14px;
      padding:12px;
      outline:none;
    }
    input:focus,select:focus,textarea:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 3px var(--accent-soft);
    }

    .row{display:grid;grid-template-columns:1fr 300px;gap:12px}
    @media(max-width:700px){.row{grid-template-columns:1fr}}

    .section{
      margin-top:12px;
      padding:14px;
      background:var(--panel-soft);
      border:1px solid var(--border);
      border-radius:14px;
    }
    .section h2{margin:0;font-size:18px}

    .pill{
      display:inline-block;
      margin-left:8px;
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      background:rgba(255,255,255,.08);
      border:1px solid var(--border);
      color:var(--muted);
    }

    .helper{
      margin-top:8px;
      font-size:14px;
      color:var(--muted);
      line-height:1.45;
    }

    .chips{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
      margin-top:12px;
    }
    @media(max-width:520px){.chips{grid-template-columns:1fr}}

    .chip{
      padding:12px;
      border-radius:14px;
      background:rgba(255,255,255,.05);
      border:1px solid var(--border);
      cursor:pointer;
      transition:.12s ease;
    }
    .chip:hover{
      background:var(--accent-soft);
      border-color:var(--accent);
    }

    .buttons{
      display:flex;
      gap:12px;
      justify-content:center;
      margin-top:16px;
      flex-wrap:wrap;
    }
    button{
      min-width:170px;
      padding:12px 18px;
      border-radius:14px;
      border:none;
      font-weight:800;
      cursor:pointer;
      background:linear-gradient(180deg,#7bb1ff,#5a90ff);
      color:#08142f;
    }
    .ghost{
      background:rgba(255,255,255,.07);
      color:var(--text);
      border:1px solid var(--border);
    }
    .dangerBtn{
      background:linear-gradient(180deg,#ff9a9a,#ff6a6a);
      color:#2a0b0b;
    }

    textarea{
      margin-top:10px;
      min-height:220px;
      resize:vertical;
      line-height:1.5;
      font-family:ui-monospace,monospace;
    }

    .status{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
      display:flex;
      justify-content:space-between;
      flex-wrap:wrap;
      gap:10px;
    }

    .footerInfo{
      margin-top:12px;
      padding-top:10px;
      border-top:1px solid var(--border);
      color:var(--muted);
      font-size:13px;
      line-height:1.45;
    }

    .mono{font-family:ui-monospace,monospace}

    /* Hide/show panels */
    .panel{display:none}
    .panel.active{display:block}

    .badgeOk{
      display:inline-block;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid rgba(121,255,166,.35);
      background:rgba(121,255,166,.10);
      color:var(--ok);
      font-size:12px;
      margin-left:8px;
    }
    .badgeWarn{
      display:inline-block;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid rgba(255,106,106,.35);
      background:rgba(255,106,106,.10);
      color:var(--danger);
      font-size:12px;
      margin-left:8px;
    }
  </style>
</head>

<body>
<div class="container">

  <div class="hero">
    <h1>Aurora Systems Research Facility</h1>
    <p>Unified Intelligence Hub: Research ‚Ä¢ Lineage ‚Ä¢ Production Issue Resolution</p>
    <div class="sub">
      <span class="mono">Author:</span> Archisma Ghosal &nbsp;‚Ä¢&nbsp;
      <span class="mono">Contact:</span> +1 302 363 3094
    </div>

    <div class="tabs" role="tablist" aria-label="Aurora Tabs">
      <div class="tab active" id="tabResearch" onclick="switchTab('research')">Research</div>
      <div class="tab" id="tabLineage" onclick="switchTab('lineage')">Lineage Intelligence</div>
      <div class="tab" id="tabProd" onclick="switchTab('prod')">Production Issue Intelligence</div>
    </div>
  </div>

  <div class="grid">
    <div class="card">

      <!-- ===================== RESEARCH PANEL ===================== -->
      <div class="panel active" id="panelResearch">
        <div class="row">
          <div>
            <label>Topic of research</label>
            <input id="topic" placeholder="e.g. Explain what RAG is in simple words"/>
          </div>
          <div>
            <label>Category of research</label>
            <select id="mode" onchange="updateMode()">
              <option value="public">Public (Internet)</option>
              <option value="confidential">Confidential (Internal)</option>
            </select>
          </div>
        </div>

        <div class="section">
          <h2 id="modeTitle">Public Search (Internet)
            <span class="pill" id="pill">‚â§ 100 words</span>
          </h2>

          <p class="helper" id="helperText">
            I‚Äôm putting my researcher hat on ‚Äî tell me what you want to research.<br/>
            <strong>Public search:</strong> I‚Äôll return a result within <strong>100 words</strong>.
          </p>

          <div class="chips" id="chips"></div>
        </div>

        <div class="buttons">
          <button onclick="runResearch()">Run research</button>
          <button class="ghost" onclick="clearOutput('out','status','endpoint')">Clear output</button>
        </div>

        <label style="margin-top:14px">Output</label>
        <textarea id="out" readonly></textarea>

        <div class="status">
          <span id="status">Status: Idle</span>
          <span class="mono" id="endpoint"></span>
        </div>

        <div class="footerInfo">
          Public search uses live internet sources. Confidential search is limited to Aurora internal data.
        </div>
      </div>

      <!-- ===================== LINEAGE PANEL ===================== -->
      <div class="panel" id="panelLineage">
        <div class="section">
          <h2>Lineage Intelligence <span class="badgeOk">Internal</span></h2>
          <p class="helper">
            Ask for end-to-end data lineage (source ‚Üí transformations ‚Üí targets).<br/>
            Example: ‚ÄúWhere does Daily Active Users come from?‚Äù or ‚ÄúShow lineage for login_events.user_id‚Äù.
          </p>
        </div>

        <label>Field / Table / Feed / Metric</label>
        <input id="lineageQuery" placeholder="e.g. daily_active_users or login_events.user_id"/>

        <div class="section">
          <h2>Quick examples</h2>
          <div class="chips" id="lineageChips"></div>
        </div>

        <div class="buttons">
          <button onclick="runLineage()">Run lineage</button>
          <button class="ghost" onclick="clearOutput('lineageOut','lineageStatus','lineageEndpoint')">Clear output</button>
        </div>

        <label style="margin-top:14px">Lineage Output</label>
        <textarea id="lineageOut" readonly></textarea>

        <div class="status">
          <span id="lineageStatus">Status: Idle</span>
          <span class="mono" id="lineageEndpoint"></span>
        </div>

        <div class="footerInfo">
          Lineage is generated from internal mapping artifacts stored in Git (feeds, mappings, schemas, transformations).
        </div>
      </div>

      <!-- ===================== PROD PANEL ===================== -->
      <div class="panel" id="panelProd">
        <div class="section">
          <h2>Production Issue Intelligence <span class="badgeWarn">Restricted</span></h2>
          <p class="helper">
            Intended for in-house support workflows.<br/>
            Private-first lookup searches historical RCAs/tickets; if no match is found, it can fall back to public research.
          </p>
        </div>

        <!-- Demo Login Gate (no credentials displayed in UI) -->
        <div class="section" id="prodGate">
          <h2>In-house Login (Demo)</h2>
          <p class="helper">
            This demo uses a simple login gate. Credentials are configured in the code (not shown in the UI).
            For production, enforce access control on the backend (SSO/OAuth/Cloudflare Access).
          </p>

          <div class="row" style="grid-template-columns:1fr 1fr 220px">
            <div>
              <label>Username</label>
              <input id="prodUser" placeholder="Enter username"/>
            </div>
            <div>
              <label>Password</label>
              <input id="prodPass" type="password" placeholder="Enter password"/>
            </div>
            <div style="display:flex;align-items:flex-end;gap:10px">
              <button class="dangerBtn" onclick="loginProd()">Login</button>
              <button class="ghost" onclick="logoutProd()">Logout</button>
            </div>
          </div>

          <div class="status">
            <span id="prodGateStatus">Status: Locked</span>
            <span class="mono">Demo-only (client-side)</span>
          </div>
        </div>

        <div id="prodMain" style="display:none">
          <label>Paste error / stack trace / logs</label>
          <textarea id="prodInput" placeholder="e.g. Traceback (most recent call last): ..."></textarea>

          <div class="section">
            <h2>Quick examples</h2>
            <div class="chips" id="prodChips"></div>
          </div>

          <div class="buttons">
            <button onclick="runProdIssue()">Analyze issue</button>
            <button class="ghost" onclick="clearOutput('prodOut','prodStatus','prodEndpoint')">Clear output</button>
          </div>

          <label style="margin-top:14px">Resolution Output</label>
          <textarea id="prodOut" readonly></textarea>

          <div class="status">
            <span id="prodStatus">Status: Idle</span>
            <span class="mono" id="prodEndpoint"></span>
          </div>
        </div>

        <div class="footerInfo">
          Aurora Systems is a fictional/dummy dataset used for demo. Replace artifacts, mappings, and incident history with any organization‚Äôs data.
        </div>
      </div>

      <!-- Footer -->
      <div class="footerInfo" style="margin-top:16px;text-align:center">
        <strong>Author:</strong> Archisma Ghosal &nbsp;|&nbsp;
        <strong>Contact Number:</strong> +1 302 363 3094
        <br/>
        Aurora Systems is fictional and used only for demonstration.
      </div>

    </div>
  </div>
</div>

<script>
  /**
   * Backend base URL
   */
  const API_BASE = "https://aurora-research-backend.onrender.com";

  // Existing backend endpoints (already in your FastAPI app)
  const PUBLIC_URL = API_BASE + "/public_search";
  const SEARCH_URL = API_BASE + "/search";

  // New endpoints (to implement later)
  const LINEAGE_URL    = API_BASE + "/lineage";
  const PROD_ISSUE_URL = API_BASE + "/prod_issue";

  // ===================== DEMO LOGIN CREDENTIALS =====================
  // NOTE: This is NOT real security. It is a demo gate only.
  const DEMO_PROD_USER = "userdummy001";
  const DEMO_PROD_PASS = "Tuser@2026";
  // ================================================================

  // Elements: Research
  const topicEl     = document.getElementById("topic");
  const outEl       = document.getElementById("out");
  const statusEl    = document.getElementById("status");
  const modeEl      = document.getElementById("mode");
  const endpointEl  = document.getElementById("endpoint");
  const modeTitleEl = document.getElementById("modeTitle");
  const helperTextEl= document.getElementById("helperText");
  const pillEl      = document.getElementById("pill");
  const chipsEl     = document.getElementById("chips");

  // Elements: Lineage
  const lineageQueryEl  = document.getElementById("lineageQuery");
  const lineageOutEl    = document.getElementById("lineageOut");
  const lineageStatusEl = document.getElementById("lineageStatus");
  const lineageEndpointEl = document.getElementById("lineageEndpoint");
  const lineageChipsEl  = document.getElementById("lineageChips");

  // Elements: Prod
  const prodGateEl = document.getElementById("prodGate");
  const prodMainEl = document.getElementById("prodMain");
  const prodGateStatusEl = document.getElementById("prodGateStatus");
  const prodUserEl  = document.getElementById("prodUser");
  const prodPassEl  = document.getElementById("prodPass");
  const prodInputEl = document.getElementById("prodInput");
  const prodOutEl   = document.getElementById("prodOut");
  const prodStatusEl= document.getElementById("prodStatus");
  const prodEndpointEl = document.getElementById("prodEndpoint");
  const prodChipsEl = document.getElementById("prodChips");

  // Tabs
  const tabResearch = document.getElementById("tabResearch");
  const tabLineage  = document.getElementById("tabLineage");
  const tabProd     = document.getElementById("tabProd");
  const panelResearch = document.getElementById("panelResearch");
  const panelLineage  = document.getElementById("panelLineage");
  const panelProd     = document.getElementById("panelProd");

  function switchTab(which){
    tabResearch.classList.toggle("active", which==="research");
    tabLineage.classList.toggle("active", which==="lineage");
    tabProd.classList.toggle("active", which==="prod");

    panelResearch.classList.toggle("active", which==="research");
    panelLineage.classList.toggle("active", which==="lineage");
    panelProd.classList.toggle("active", which==="prod");

    if(which==="research") endpointEl.textContent = (modeEl.value==="public" ? "/public_search" : "/search");
    if(which==="lineage") lineageEndpointEl.textContent = "/lineage";
    if(which==="prod") prodEndpointEl.textContent = "/prod_issue";
  }

  function setTopic(el, t){ el.value=t; el.focus(); }

  function clearOutput(outId, statusId, endpointId){
    const out = document.getElementById(outId);
    const st  = document.getElementById(statusId);
    const ep  = document.getElementById(endpointId);
    if(out) out.value = "";
    if(st)  st.textContent = "Status: Idle";
    if(ep && ep.id==="endpoint") ep.textContent = (modeEl.value==="public" ? "/public_search" : "/search");
  }

  function trim100(text){
    const cleaned = String(text || "").trim();
    if(!cleaned) return "";
    const w = cleaned.split(/\s+/);
    return w.length<=100 ? cleaned : w.slice(0,100).join(" ")+" ‚Ä¶";
  }

  function renderChips(list, parentEl, targetInputEl){
    parentEl.innerHTML = "";
    list.forEach(t=>{
      const d=document.createElement("div");
      d.className="chip";
      d.textContent=t;
      d.onclick=()=>setTopic(targetInputEl, t);
      parentEl.appendChild(d);
    });
  }

  // Samples
  const confidentialSamples = [
    "List the major HR policies mentioned in the Aurora policy manual.",
    "According to the policy manual, what rules exist about remote or hybrid work?",
    "Summarize Aurora Systems' code of conduct and disciplinary process.",
    "What is the leave policy (PTO/sick leave) described in the policy manual?",
    "What are the security and data handling rules for employees?",
    "Summarize Aurora Systems' strategic pillars and long-term goals.",
    "What are the top strategic initiatives for the next 3 years?",
    "Show revenue by quarter for 2023 and summarize the trend.",
    "What is the trend of R&D spend by quarter in 2023?",
    "Compare gross margin % across 2023 quarters and summarize the trend."
  ];

  const publicSamples = [
    "Explain what RAG is in simple words.",
    "What are the best free cloud hosting options for small apps?",
    "Summarize recent technology headlines.",
    "Give me a 2-day trip plan for Boston.",
    "Find recent updates about OpenAI products."
  ];

  const lineageSamples = [
    "Show lineage for daily_active_users",
    "Where does the Daily Active Users report come from?",
    "What upstream feeds impact login_events.user_id?",
    "Which tables are downstream of login_events?",
    "Show source ‚Üí transformation ‚Üí target for user_login_count"
  ];

  const prodSamples = [
    "Traceback (most recent call last):\n  File \"report_job.py\", line 78, in <module>\n    df = df.merge(users, on=\"user_id\")\nKeyError: 'user_id'",
    "ERROR: Load failed due to NOT NULL constraint violation on table aurora_daily_metrics",
    "TimeoutError: ETL job exceeded maximum runtime threshold",
    "ValueError: cannot convert float NaN to integer",
    "DatabaseError: deadlock detected while updating aurora_report_table"
  ];

  function updateMode(){
    const isPublic = modeEl.value==="public";

    if(isPublic){
      modeTitleEl.childNodes[0].textContent = "Public Search (Internet) ";
      pillEl.textContent = "‚â§ 100 words";
      helperTextEl.innerHTML =
        "I‚Äôm putting my researcher hat on ‚Äî tell me what you want to research.<br/>" +
        "Also: I‚Äôm a tiny baby-researcher üë∂üîé so I‚Äôll keep it simple and short.<br/>" +
        "<strong>Public search:</strong> I‚Äôll return a result within <strong>100 words</strong>.";
      endpointEl.textContent = "/public_search";
      renderChips(publicSamples, chipsEl, topicEl);
    } else {
      modeTitleEl.childNodes[0].textContent = "Confidential Search ";
      pillEl.textContent = "Internal docs";
      helperTextEl.innerHTML =
        "Confidential research uses your internal Aurora knowledge base.<br/>" +
        "Also: I‚Äôm a tiny baby-researcher üë∂üìÑ so I‚Äôll keep it simple and focused.<br/>" +
        "<strong>Note:</strong> Aurora-only topics ‚Äî no public web searching in this mode.";
      endpointEl.textContent = "/search";
      renderChips(confidentialSamples, chipsEl, topicEl);
    }
  }

  // Initialize chips and endpoints
  updateMode();
  renderChips(lineageSamples, lineageChipsEl, lineageQueryEl);
  renderChips(prodSamples, prodChipsEl, prodInputEl);
  lineageEndpointEl.textContent = "/lineage";
  prodEndpointEl.textContent = "/prod_issue";

  async function runResearch(){
    const topic = topicEl.value.trim();
    if(!topic){ outEl.value="Please enter a topic."; return; }

    statusEl.textContent="Status: Running‚Ä¶";
    outEl.value="Running research‚Ä¶";

    const isPublic = modeEl.value==="public";
    const url  = isPublic ? PUBLIC_URL : SEARCH_URL;
    const body = isPublic ? { topic } : { query: topic };

    try{
      const r=await fetch(url,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify(body)
      });

      if(!r.ok){
        const text = await r.text();
        throw new Error(text || ("HTTP " + r.status));
      }

      const data = await r.json();
      const answer = data.answer || JSON.stringify(data,null,2);

      outEl.value = isPublic ? trim100(answer) : answer;
      statusEl.textContent="Status: Done";
    }catch(e){
      outEl.value="Error:\n"+(e && e.message ? e.message : String(e));
      statusEl.textContent="Status: Error";
    }
  }

  async function runLineage(){
    const q = lineageQueryEl.value.trim();
    if(!q){ lineageOutEl.value="Please enter a field/table/feed/metric."; return; }

    lineageStatusEl.textContent="Status: Running‚Ä¶";
    lineageOutEl.value="Running lineage‚Ä¶";

    try{
      const r=await fetch(LINEAGE_URL,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({ query: q })
      });

      if(!r.ok){
        const text = await r.text();
        throw new Error(text || ("HTTP " + r.status));
      }

      const data = await r.json();
      lineageOutEl.value = data.answer || JSON.stringify(data,null,2);
      lineageStatusEl.textContent="Status: Done";
    }catch(e){
      lineageOutEl.value =
        "Lineage endpoint not ready yet OR backend returned an error.\n\n" +
        "Expected endpoint: POST " + LINEAGE_URL + "\n\n" +
        "Error:\n" + (e && e.message ? e.message : String(e));
      lineageStatusEl.textContent="Status: Error";
    }
  }

  // ===================== Production Login Gate (DEMO ONLY) =====================
  const PROD_SESSION_KEY = "aurora_prod_unlocked_session_v1";

  function setProdUnlockedUI(isUnlocked){
    if(isUnlocked){
      prodGateEl.style.display = "none";
      prodMainEl.style.display = "block";
      prodGateStatusEl.textContent = "Status: Unlocked (session)";
    } else {
      prodGateEl.style.display = "block";
      prodMainEl.style.display = "none";
      prodGateStatusEl.textContent = "Status: Locked";
      if(prodUserEl) prodUserEl.value = "";
      if(prodPassEl) prodPassEl.value = "";
    }
  }

  function loginProd(){
    const u = (prodUserEl.value || "").trim();
    const p = (prodPassEl.value || "").trim();

    if(u === DEMO_PROD_USER && p === DEMO_PROD_PASS){
      sessionStorage.setItem(PROD_SESSION_KEY, "true");
      setProdUnlockedUI(true);
    } else {
      sessionStorage.removeItem(PROD_SESSION_KEY);
      prodGateStatusEl.textContent = "Status: Locked (invalid credentials)";
    }
  }

  function logoutProd(){
    sessionStorage.removeItem(PROD_SESSION_KEY);
    setProdUnlockedUI(false);
  }

  setProdUnlockedUI(sessionStorage.getItem(PROD_SESSION_KEY) === "true");

  async function runProdIssue(){
    const text = (prodInputEl.value || "").trim();
    if(!text){ prodOutEl.value="Please paste an error / stack trace / logs."; return; }

    prodStatusEl.textContent="Status: Running‚Ä¶";
    prodOutEl.value="Analyzing production issue‚Ä¶";

    try{
      const r=await fetch(PROD_ISSUE_URL,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({ issue: text })
      });

      if(!r.ok){
        const t = await r.text();
        throw new Error(t || ("HTTP " + r.status));
      }

      const data = await r.json();
      prodOutEl.value = data.answer || JSON.stringify(data,null,2);
      prodStatusEl.textContent="Status: Done";
    }catch(e){
      prodOutEl.value =
        "Production issue endpoint not ready yet OR backend returned an error.\n\n" +
        "Expected endpoint: POST " + PROD_ISSUE_URL + "\n\n" +
        "Error:\n" + (e && e.message ? e.message : String(e));
      prodStatusEl.textContent="Status: Error";
    }
  }

  switchTab("research");
</script>
</body>
</html>
